{% extends "base.html" %}
{% block content %}

<div class="d-flex justify-content-between align-items-center mb-3">
  <h2>Mis Tareas</h2>
  <a href="{% url 'task_create' %}" class="btn btn-primary">➕ Nueva tarea</a>
</div>

<table id="taskTable" class="table table-striped table-bordered align-middle">
  <thead class="table-dark">
    <tr>
      <th>Hecha</th>
      <th>Tarea</th>
      <th>Creada</th>
      <th>Fecha límite</th>
      <th>Acciones</th>
    </tr>
  </thead>
  <tbody>
    {% for task in tasks %}
      <tr
        class="
          {% if task.completed %}table-success
          {% elif task.is_overdue %}table-danger
          {% elif task.is_due_soon %}table-warning
          {% else %}table-light
          {% endif %}
        "
      >

        <td>
          {% if task.completed %}
            <form method="post" action="{% url 'task_decomplete' task.id %}">
              {% csrf_token %}
              <button type="submit" class="btn btn-sm btn-success">
                ✔
              </button>
            </form>

          {% else %}
          <form method="post" action="{% url 'task_complete' task.id %}">
            {% csrf_token %}
            <button type="submit" class="btn btn-sm btn-outline-secondary">
              ○
            </button>
          </form>
          {% endif %}
        </td>
        <td><a href="{% url 'task_update' task.id %}">{{ task.title }}</a></td>
        <td>{{ task.created_at|date:"Y-m-d H:i" }}</td>
        <td>{{ task.due_date|date:"Y-m-d" }}</td>
        <td>
          <a href="{% url 'task_delete' task.id %}" class="btn btn-danger btn-sm">🗑</a>
        </td>
      </tr>
    {% endfor %}
  </tbody>
</table>

<link rel="stylesheet"
      href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css">
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>

<script>
$(document).ready(function() {
  $('#taskTable').DataTable({
    "pageLength": 5,
    "order": [[2, "desc"]],
    "language": {
      "url": "//cdn.datatables.net/plug-ins/1.13.6/i18n/es-ES.json"
    }
  });
});
</script>

{% endblock %}
